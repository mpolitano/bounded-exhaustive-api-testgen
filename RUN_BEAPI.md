# Running `BEAPI` on your own case study


In this section we provide a script to run beapi to generate a tests for any case study.
To use this script, you need to create the directory in the same way as the existing benchmarks in the repository.
We provide new data structures taken from a [repository of Github](https://github.com/anthonynsimon/java-ds-algorithms)

To generate tests using `BEAPI` with a given configuration run the following script:

```
./run-beapi.sh <benchmark> <case study> <scope> <literalsFile> <configurationFile> <buildersFile>
```

where `<benchmark>` is a folder a src code for generate tests; `<case study>` is one of the case studies inside the `<benchmark>` ; `<scope>` PABLO: Scope only use for set iterations in maxBEit  ; `<literalsFile>` is a file that contains the integers for use in the generation (see section [Literals file](#Literals-File)) ;`<configurationFile>` a file with BEAPI’s scope definition (see section [Scope definition](#scope-definition)) and `<buildersFile>` a file with methods builders for use in BEAPI (see section [Builders File](#builders-file)) 


For example, to generate inputs for `MultiStackArray` from the [repository of Github] (https://github.com/anthonynsimon/java-ds-algorithms), should be cloned the repository:
```
git clone https://github.com/anthonynsimon/java-ds-algorithms
```
Then, create a folder in the repository with the format of the other benchmarks in the $BE_EXP_SRC directory.

For example, we provide a new `benchmark` with the name `5_github` to reference the aforementioned repository

```
./run-beapi.sh 5_github com.anthonynsimon.datastructures.MultiStackArray 3 literals/literals3.txt properties/scope3.all.canonicalizer.properties results-builders/5_github/com.anthonynsimon.datastructures.MultiStackArray/builders.txt
```

Note: To automatically identify builders, you can run:
```
./run-builder-identification.sh 5_github com.anthonynsimon.datastructures.MultiStackArray
```
The tool saves a result file that can be used in BEAPI. The resulting file is in the folder scripts/results-builders/`<benchmark>`/`<case study>`/builders.txt


The  **tests suite** generated by `BEAPI` is stored in the `beapi-tests` folder, located inside the specified project. For the example given above, the tests are stored in `0_korat/beapi-tests`. 

The screen shows the log from BEAPI tool.

## Literals File
One has to specify the values that will be employed by BEAPI to invoke API routines that take primitive type parameters (e.g., elements to insert into the list, etc.). 
For this purpose, BEAPI need a file that contains the literal values to be used as inputs to methods under test.

The file format should be as follows:
```
START CLASSLITERALS
CLASSNAME
java.lang.Integer
LITERALS
int:0
int:1
int:2
END CLASSLITERALS
```

In the example above, we specify a range of integers that BEAPI will use. One could also specify domains for other primitive types like floats, doubles and strings by describing their values by extension.

## Scope Definition

BEAPI need a configuration file defining BEAPI’s scopes for a case study. The `max.objects` parameter specifies the maximum number of different objects (reachable from the root) that a structure is allowed to have. Test sequences that create a structure containing a larger number of different objects (of any class) than `max.objects` will be discarded (and the structure too). Also, we can inform BEAPI which are the relevant field to consider for structure canonicalization, or which fields from the structures to omit (`omit.field`). This allows the user to control the state matching process. For example, line 2 would make BEAPI omit the `modCount` fields in state matching. In this case, omitting the field does not change anything in terms of the different structures generated by BEAPI, but in other cases omitting fields may be important. The configuration files used in our experimental section are similar to the one shown here.

```
max.objects=1\3
omit.fields=modCount
```

## Builders File

BEAPI employs only a subset of the API routines to create test sequences. For this purpose, we need provide to BEAPI a file with the methods builders. (See last paragraph of Section 4.2)

For the case MultiStackArray, the builders file contains:
```
com.anthonynsimon.datastructures.MultiStackArray.<init>\(int,int\)
com.anthonynsimon.datastructures.MultiStackArray.push\(int,java.lang.Object\)

```
NOTE: Parentheses in methods must be escaped for them to work on BEAPI. Remember that this file can be generated automatically from the builder identification script. (See [here](BEAPI_OPT.md) 

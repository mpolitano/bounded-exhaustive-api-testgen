# Assessing the impact of `BEAPI`'s optimizations (RQ2 in Section 4.2 of the paper)

In this experiment, we assessed the impact of `BEAPI`'s optimizations in its performance. We provide four different ways to execute `BEAPI`: DEFAULT (SM/BLD in Section 4.2 of the paper) is `BEAPI` with state matching enabled (SM) and using identified builders (BLD); SM is `BEAPI` with only state matching (SM) enabled; BLD is `BEAPI` using identified builders (BLD); and NoOpt is `BEAPI` with both optimizations disabled. 

## Running a single experiment

First, move to the scripts folder.

```
cd scripts
```

To generate inputs using `BEAPI` with a given configuration run the following script:

```
./run-testgen-beapi-optimizations.sh <benchmark> <case study> <scope> <config>
```

where `<benchmark>` is one of `0_korat`, `1_kiasan`, `2_roops`, `3_fajita`, `4_real_world`; `<case study>` is one of the case studies for `<benchmark>` (see section [Available case studies](#Available-case-studies)); `<scope>` is the maximum number of nodes and the number of integers (from 0 to scope-1) available for generation, and `<config>` is one of the four aformentioned `BEAPI` configurations: `DEFAULT`, `SM`, `BLD`, `NoOpt`.

For example, to generate inputs for `SinglyLinkedList` from the `0_korat` benchmark using `BEAPI`'s `DEFAULT` configuration with a scope of `4` execute: 
```
./run-testgen-beapi-optimizations.sh 0_korat korat.examples.singlylinkedlist.SinglyLinkedList 4 DEFAULT

```

At the end of its execution the script shows a summary of the results in CSV format:

```
************
Report
Project,Class,Technique,Budget,Time,Structures,Explored
0_korat,korat.examples.singlylinkedlist.SinglyLinkedList,beapi/matching/builders,4,.22,85,345
************
```

where:

- **Project**: the name of the selected benchmark.
- **Class**: the name of the case study.
- **Technique**: the generation technique employed:
    - `beapi/matching/builders` is `BEAPI`'s `DEFAULT` configuration
    - `beapi/matching/no-builders` is `BEAPI`'s `SM` configuration  
    - `beapi/no-matching/builders` is `BEAPI`'s `BLD` configuration
    - `beapi/no-matching/no-builders` is `BEAPI`'s `NoOpt` configuration 
- **Budget**: is the scope (maximum number of nodes, integers, etc...) used for input generation.
- **Time**: is the time spent for input generation in miliseconds.
- **Structures**: the number of structures generated by `BEAPI`.
- **Explored**: the number of test sequences explored by `BEAPI`.

Notice that **Table 2** of **Section 4.2** of the paper shows only the time spent on generation for each `BEAPI` configuration (i.e. column Time in the CSV). Notice that we report runtimes in seconds in the paper, while in the CSV we report runtimes in milliseconds. The correspondence from the fully qualified name of a case study (i.e. `korat.examples.singlylinkedlist.SinglyLinkedList`) to its abbreviated name (i.e. `SLList`) is listed below in section [Available case studies](#Available-case-studies).

A log of the output of the selected tool is saved to file:

```
$BE_EXP_SRC/scripts/results-optimizations/<benchmark>/<case study>/<technique>/<scope>/log.txt
```

For the execution above, the log for `BEAPI` is in file:

```
$BE_EXP_SRC/scripts/results-optimizations/0_korat/korat.examples.singlylinkedlist.SinglyLinkedList/beapi/matching/builders/4/log.txt
```  

The results of the (successive) executions of the script are saved in file: 

```
$BE_EXP_SRC/scripts/	results-optimizations/results_optimizations.csv
```

**Note**: The precomputed builder methods used to run the `BEAPI` configurations that require them (`DEFAULT` and `BLD`) in this experiment are stored in plain text in `$BE_EXP_SRC/scripts/config/<benchmark>/builders/<case study>` file. For example:

```
% cat $BE_EXP_SRC/scripts/config/0_korat/builders/korat.examples.singlylinkedlist.SinglyLinkedList 

korat.examples.singlylinkedlist.SinglyLinkedList.<init>\(\)
korat.examples.singlylinkedlist.SinglyLinkedList.add\(java.lang.Object\)
```

**Note**: The ***test suite*** generated by `BEAPI` is stored in the `beapi-tests` folder located inside the specified project. `BEAPI` generates suites in the JUnit testing framework. In the example above, the JUnit tests are stored in `$BE_EXP_SRC/0_korat/beapi-tests`. For efficiency reasons, we do not serialize the objects generated by `Korat` in this experiment.

## Available case studies

- `0_korat`
  - `DoublyLinkedList`: korat.examples.doublylinkedlist.DoublyLinkedList (`DDList`)
  - `FibonacciHeap`: korat.examples.fibheap.FibonacciHeap (`FibHeap`)
  -	`BinomialHeap`: korat.examples.binheap.BinomialHeap (`BinHeap`)
  - `SearchTree`:korat.examples.searchtree.SearchTree (`BST`)
  - `SinglyLinkedList`: korat.examples.singlylinkedlist.SinglyLinkedList (`SLList`)
  - `RedBlackTree`: korat.examples.redblacktree.RedBlackTree (`RBT`)
  - `SortedList`: korat.examples.sortedlist.SortedList (`SortedList`) 

- `1_kiasan`
  - `BinarySearchTree`: binarysearchtree.BinarySearchTree (`BST`)
  - `DoubleLinkedList`: doublylinkedlist.DoubleLinkedList (`DDL`)
  - `TreeSet`: redblacktree.TreeSet(`RBT`) UBICAR LOS FUENTES DONDE CORRESPONDE con el nombre correcto
  - `DisjSetsFast`: disjointSet.fast.DisjSetsFast (`DisjSetFast`)
  - `StackLi`: stack.list.StackLi (`StackList`)
  - `BinaryHeap`: binaryheap.BinaryHeap (`BHeap`)
  - `TreeMap`: redblacktree.TreeMap (`TreeMap`)
  - `DisjSet`: disjointSet.orig.DisjSets (`DisjSet`) 

- `2_roops`

  - `AvlTree`: avl.AvlTree (`AVL`)
  - `NodeCachingLinkedList`: ncl.NodeCachingLinkedList (`NCL`)
  - `BinTree`: bintree.BinTree (`BinTree`)
  - `LinkedList`: linkedlist.LinkedList (`LList`)
  - `TreeSet`: rbt.TreeSet (`RBT`)
  - `FibHeap`: fibheap.FibHeap (`FibHeap`)
  - `BinomialHeap`: bheap.BinomialHeap (`BinHeap`)

- `3_fajita`
  - `BinTree`: bintree1.BinTree (`BinTree`)
  - `AvlTree`: avl1.AvlTree (`AVL`)
  - `TreeSet`: rbt.TreeSet (`RBT`)
  - `BinomialHeap`: bheap.BinomialHeap (`BinHeap`)
  - `SinglyLinkedList`: list.SinglyLinkedList (`SLList`) 
  - `DoubleLinkedList`: cdlist.LinkedList (`DLList`)
  - `NodeCachingLinkedList`: cList.NodeCachingLinkedList (`NCL`)

- `4_real_world`
 
  - `NodeCachingLinkedList `: org.apache.commons.collections4.list.NodeCachingLinkedList (`NCL`)
  - `TreeSet`: java2.util2.treeset.TreeSet (`TSet`)
  - `TreeMap`: java2.util2.treemap.TreeMap (`TMap`)
  - `LinkedList`: java2.util2.linkedlist.LinkedList (`LList`)
  - `HashMap`: java2.util2.hashmap.HashMap (`HMap`)


Note: In parentheses are the short names used in **Table 2** of **Section 4.2** of the paper to identify each case study. The results for some case studies are not reported in the table for space reasons; these can be found online [Replication Package](https://sites.google.com/view/bounded-exhaustive-api/home).

## Running all experiments from a single benchmark (slow)

To reproduce all the experiments for a specific benchmark using all four `BEAPI` configurations, for all scopes within 3 and *maxScope* pick and run one of following commands: 

```
./run-testgen-beapi-optimizations-0_korat.sh <maxScope>
./run-testgen-beapi-optimizations-1_kiasan.sh <maxScope>
./run-testgen-beapi-optimizations-2_roops.sh <maxScope>
./run-testgen-beapi-optimizations-3_fajita.sh <maxScope>
./run-testgen-beapi-optimizations-4_real_world.sh <maxScope>
```

Note: Running one of the above scripts might take a few day depending on your hardware.

## Running all the experiments (very slow)

To reproduce all the experiments for this research question run:
```
./run-testgen-beapi-optimizations-all.sh <maxScope>
```

Note: Running this script might take a few days depending on your hardware.


# Running automated builders identification (Last paragraph of Section 4.2)

An automated builders identification approach was first presented in previous work:

- P. Ponzio, V. Bengolea, M. Politano, N. Aguirre, M. Frias, *Automatically Identifying Sufficient Object Builders from Module APIs*. Fundamental Approaches to Software Engineering, FASE 2019.

Recall that the goal of this paper is to assess the impact of using builder routines for BE generation from an API, not on builder computation approaches. Anyway, below we provide scripts to replicate the results of the builders identification approach employed in our paper.

## Running a single experiment

Don't forget to move to the scripts folder.

```
cd scripts
```

To identify builder methods for a given case study, run the following script:

```
./run-builder-identification.sh <benchmark> <case study>
```

**Note**: The script uses a fixed scope of 5 for builders identification, as this was the scope we used for this experiment in the paper.

where `<benchmark>` is one of `0_korat`, `1_kiasan`, `2_roops`, `3_fajita`, `4_real_world`; `<case study>` is one of the case studies of `<benchmark>` (see section [Available case studies](#available-case-studies)).

For example, to identify builders for `SinglyLinkedList` from the `0_korat` benchmark, execute: 

```
./run-builder-identification.sh 0_korat korat.examples.singlylinkedlist.SinglyLinkedList

```

At the end of its execution the script shows a summary of the results in CSV format:

```
************
Report
Project; Class; Builders ; Time ; nMethods
0_korat ; korat.examples.singlylinkedlist.SinglyLinkedList ; [korat.examples.singlylinkedlist.SinglyLinkedList.<init>(), korat.examples.singlylinkedlist.SinglyLinkedList.add(java.lang.Object)] ;  8s ; 5
************
```

where:

- **project**: the name of the selected benchmark.
- **case study**: the name of the case study.
- **builders**: the identified builders from the API of the case study. In this example:
    - `korat.examples.singlylinkedlist.SinglyLinkedList.<init>()` (parameterless SinglyLinkedList constructor).
    - `korat.examples.singlylinkedlist.SinglyLinkedList.add(java.lang.Object)` (method to add an object to the list).
- **time**: the time spent for builders identification in seconds.
- **nMethods**: Number public methods in the API of the case study.

The results of the (successive) executions of the script are saved in file: 

```
$BE_EXP_SRC/scripts/results-builders/results_builders.csv
```

## Running all experiments from a single benchmark


To identify builders for all case studies for a specific benchmark, pick and run one of following commands: 

```
./run-builder-identification-0_korat.sh
./run-builder-identification-1_kiasan.sh
./run-builder-identification-2_roops.sh
./run-builder-identification-3_fajita.sh
./run-builder-identification-4_real_world.sh
```

The results of executing these scripts are saved in file: 

```
$BE_EXP_SRC/scripts/results-builders/results_builders.csv
```

## Running all the experiments 

To identify builders for all [available case studies](#available-case-studies) run:

```
./run-builder-identification-all.sh
```

The results of executing this script are saved in file: 

```
$BE_EXP_SRC/scripts/results-builders/results_builders.csv
```
